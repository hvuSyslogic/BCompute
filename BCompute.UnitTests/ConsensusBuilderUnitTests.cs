using System;
using System.Collections.Generic;
using System.Linq;
using NUnit.Framework;

namespace BCompute
{
    [TestFixture]
    public class ConsensusBuilderUnitTests
    {
        #region FastaBlobs
        private const string _sampleFastaSequences = @">Rosalind_1
ATCCAGCT
>Rosalind_2
GGGCAACT
>Rosalind_3
ATGGATCT
>Rosalind_4
AAGCAACC
>Rosalind_5
TTGGAACT
>Rosalind_6
ATGCCATT
>Rosalind_7
ATGGCACT";

        private const string _hugeFastaSequences = @">Rosalind_3714
TAAAATGCAGCATCATTGTGCCCAGCTTATGCTAAGCCTCGGATCCACTCCCTCTTATGC
TGCATCCCGCTCACCCCTTGTTGACAGATCTCCGCAACCACTAACGCCGACCGAAGGTAG
TATACACCTGCCGCGACGCCGAATCCCTATGGCTTACGTTATAGCAGTGCCGAAGTTATG
GCTTTTTTCTTCGGACTTAGTTCGCGCCGGGTTTCTACATCCTAACGTCGCGTAGCATAA
GTCCCGCGAAAGGGCATATCCCCAGAAATTTAGCGCACCAGGTGGTAAACCAATCCGGTA
CGTGAATTTACGTTTCTCGTTTGTAGTGGTATCTGGAACGTGTAATATAGCGTGTAGTAG
AGGTGGCACGAAAGCGATGCGCCCGCTCACGAGCGTGCGGTGTTCACCGACCCCTCAAGT
AACGTTAATGCTGGAGGTCAAAGAAGGGGAGTCAAAGTCGAGGGAACTGTCGTCCCGGCA
CTACTGTTATCACATCAGGTCATTCGTAGAATCACCTTGATCATTTGTTGACACTTACGT
TCTTCTTAGGGCCTAACCTCATTGCTCAACCTTGTCAAGTTGAGCGCGCCATCTAACTCC
GGCATGGACGAGTATATGTACACACCAGTAGTGAATCATACTATATGGTATCCGGTCGTT
TGAACACACCGCGCAAGCTATAGGGTGGGATAAAGGCCCTAGGTACTGTGTAGTACGAAG
CTCGACGTCGTGCATGGTGTCGTGAGGTCCATCCCTGAGGACTTGACATGCGGCGGGTCT
GACGGTTAATGGAGCCATCCCCTACCCGAGCGTGTCCCCCCTGTAGATTTCCTGCACGAC
GGTTGTATCATCTCAGACAGCCCTGACGTCAGCCCATCGGTGCGCCAATCAGAAAGTAAC
TTAG
>Rosalind_5027
GCAGCACATGTGGCGTACGTACCGCTTATTGAGTGCGTGATGCCGCCCCGTCTGCCCACC
ACTAATTACTATCCGATTGTATGGTTTTCACAGAGGGTTCTTAACTGCGCCCCAATGTTG
TGCTCTACGCGCCGAGTGGTCCTCCTTAATAAGAGATCGTGTTTTATTGCTATCTGTTAA
TATGCCGAGGCAAATAGAATTAAGCCAACGGGAACCTGCCGCCAAATGACCTGCCCATCC
TGGTTCCAGCGGACAACAAGCAGAAGAAGGGGGTTAGCGACTAACACCGACTGTCACAGC
CGAAAGGTTTTTGCTGAATGTACTGTTAAATGCAAGGCAAGTCGTTTTAAAGGTACATTG
ACCGGGAACCCGCGAATAGCATTAGCAGTAAAGCGTAGTACCCTATGGTATTTCATTTTA
TTTTCGCTACCGACCTTAGGCAAAGTCTCGGTGTGGCTGTCAGATAAGACTGATTTCAAA
AACCGTTAGCAACCTGCAAAGTCGTGTGCTTTGTGTACATGATGGATCCTGGAAATGAAG
GACGTGCGCGCCAGTCATTTTTAACGTGAGAACTCCGCCAAACATGGAAGTCCGTAATAC
TATATGGCCAAAAAAGAGTAGGTTGACAAGATGTAACAGCTGCGTTAGAAGTCCCCTAGA
TCTAACTTCCATAACGATTGGTTCGTTAGGCACGGGTGCTATGATCATCACTCGAACCTG
CATGCAGCAAACATGGTAATAGCGCCCTACAGAACTACTAAAACGGCATTCTATCACACG
TTGCAGACCGGGCCACAAATTCGAAGGAAATTCGCGGCTTACGCGAGGTCAAACGACTAT
ACGTTGATTTCGCTACTTTTGTTAGAAAGGTAACGGTTCGACATTCATTGGGCCGCACGA
AGAG
>Rosalind_8481
TGGTCTAAAGTGCCACGGTCCGCCAGGCGTTTCGAGATGGGCCGGAAAGAAAATTCGCCA
TAGCATAAGAAGTGTTGCGCCTCAGTTAACAACGAAAGGACCCGCACTGTATTTCGCTTC
TTAGCTGTTGGATCCGCCGCTAACCGAGTGGGGCTATAGCCATAAACTTAAATCGACGGA
TTATGATTTCTCAGGTATGTGTAACAGATAAAACACGCTTGCTCCTGCCCGATCTACAAT
TTTGGCGGCATCCCTAATCGGAGATACCTAAGGCATTACACGTTATGCAGTAGGGGATCG
TGATGCCATAGGGAATCCCAATTTTCACATGTTGTCTATATTGTATCTCGAAACTCCGTG
ACCCGTGAGAATGAACACCCTATAAGGCCCGCGGAATTCCTACAATCGTGGCAAAAGAGT
GTAGGGTCTTGCACATGTGCCGGCCCCACGTAATCGGAACTCCTGTCATGTAACTCCTGC
GGAGCATTATGGTATGACCCTATATTTCCCTGGATACCATCTATAGCATTGTGTTGACAG
CCACTAGAATTCCAGGTAACGCATCCGCAGTAACCAACATTGTGCCGCGCGGGATCCCGG
CCCGCGTACATACTTAAGAACGGGATATATTAAAGATATCAGATTTAAATGGATATCAAA
ATCACCCTCGTTAGTTTTGCCATGCCTTCGCTCCACTCTGGACCCACGTCCTACCAGATT
TTATGATGTCCAATGCACGGGCCCATTAGTCAATGTGACCTCAGTACCACGAGACCAGTC
AGGAATGGCTGGCCACGGAAGCAGTAAGCGCCCACCGCGGATTAATTGATTTTGAAGGGG
AGTATCTCAGATAAAGCGAGATTCCCGGGGGTCTTAACACCTTGTGCAACCACTAAAGAC
GACC
>Rosalind_7637
TGCGCTTACGCGGTAATGCTGCTTATAGGCAAATGATGATTGGCGTAATCTTACGCAGTT
CGACCACAGATCCCGGCCACCGAACCTAGGTGGCCAATTCACTCGCGATAGCACTAATTA
TTTGGCATATGGTCCAAAGTCATTCAAAAATGGCTCTTACATGACGCATCATTGGCCGCC
AGATATACGGTGCCCATATTGGGTGGGCGACGCCCAGAGCCTAGGTTCTTATCTCAACGA
TTACCTGCTTCTTGGTTGTTCCAGGGTTGTCTCTTATGTTCCTACAGTTGAGAGGGGCCG
TAAGGGGTGTCCTTTTTGAGGTGTCAGTGATAGACTCGCGACTACAAAGATCGTAACGTT
CGGCGTAGCGGGGGATTCTATGGCGGACTACGAACCACCCATTAACAGTCCAGTAAGACT
TAACTTAAGAGCATTGACTGGTAGTCGGATAATGGCTGGAAGTTACTATAGTCCTTAGTA
CATGGAAAGTCTTGTCACCCTGTGAGCGTAAGCTCGCCGGGGGGTGTTTTCTGCGTATTG
TCTCGAACGTAGTCAAAATCTCAACCGCTTCTTGCTGGGTTGTTGTGATAACCTATAGCG
GTCTGCAAATGTGCACTGCGAAAGAAACTTAGCAAAGAATGATGTAAAAGCCCTCACAGG
TCGTTACGATAATAATAACCCAGACTAACCAGACACCGGATCGAAATGTTTAGGTTTTCC
GGTCCGAGTTTTCGGCTCACGGGGCTGTTCCCGTAGATGTGAAGGTCCTTTCCGGCGAGC
GGACTAACAAAGTTTGCCGTGTTTGCTGTCCAGGAGGCGGCAAGATGAACCGGCAGAAGT
CAATTCAAGCAATGCTCAGTTAGGAGACGTCTTTAGGACTGCGAGTCAATAACGCGCGCA
GAAC
>Rosalind_1937
AGCTTGGTGTCCTAACTACCGGTGACTTCAAGGATCGAAGACCATTCCTTTCTAGAACGT
AGAGCTGCGGATATAAGAGACTCACGGCTGCCCGACCGGCGGATCGGAACAGCATCGCTA
GGTGCAACAAAGGCAAGGCATGGTGGCTGTCATCAAACTCGTAGCTCTATCGAGTAACCA
GAGGAAAGCTACCCACCTGCATCTGTGCGATAAGCGAAGGTCTATTAAGAGTCATCATAT
TTTATTTGCTTGCGCCCGCGTTCATCTGTGTTAAATTGAGGTATACGTCGATCAGGATCA
TTCGGACCTACGTTGTAATCTGACGTTTTGGGAGAAGTTCACGCTAAACCTAAGGCTCTC
GGGACCGTCCTAATTGAGGGTGAGATTCAGCTAGGTCGAATCCGCCGAAACAGTAGCTTT
TTGATCTAGATAAACTCGTTTCGAACTCAGTTGTGCTTGATAGGACGAGATATCAACCGG
GTGTCCGGTCCTTTGGACTGCATATCTTTAGCCGACACGTCTTTATAGCTACGGCAACAT
CCGTCAACTTTGACAAGTCTTAGCGCTGCTCGTTAACAGCTCTTATGGCTTGAACATTAT
CGTCTTTTACTTAGATCGAGCCGTACCTTTTCCGTTTGTGCCGAAAGTACAAGGACCATA
CGATCTTACTACGCTATGTAACACCCATGTAGGGTAGAGTAGGCTATATTGTTTGCCAGG
GCATCATACGTGGCATGACGATTAGGTAATTACACGGCATCCCGGTAAACGCTCTGCCTC
AAACAATTCTATAGATTATCTGCCAACTCTATCTATTAGACAGGCCAGTCGATGATTCCC
CCCATGTTGCTATCAATCTACCTGGTTCTAGAACATGCTATTTTATGTGCCCATGGATGG
CGAC
>Rosalind_0257
ACATGGGGAACGACGCATCCGGAGAGCACCACCTTTAGGAAGAATCGACTAAGTCTTACT
TCTTCCACCATCGTCCCGGTCACCTTATACTATATTGGGTATCTCCTGGCTCTCAGCCTT
CCAGTAGTACCACACCGTTCTTAGAATTGAAGACACAATCTTCGACGTCTACGACGTTCC
TGAAACGTCACTTTCCGGGCGCCTATTCGGAGAGCGTGGTCCGCCTTCTTAAGGCGGCGA
AGCTGGCGTTTCTGTCTTCCACGCGCGCCTACCGTATGGCTATTGCTCGAAACCGCCTCT
TTTACATCTAAATGGTTTTGTTTGGATCTCAGAGATCTGAAGTGAGAGATAAACTGAACA
TGTGAATGTTGGCTAAGGAAGAGTTCATAGATCCACATATATCAACATTCGTCAGCCGTT
GCACTACCGACGGAATTCTATCATGGTAATAGCGCGTGGCGGGGTACAAACAAGTGGCCC
TTATTTCATTTTCTGCAAGAGTTATTTAGCCACTAGTTGTATTTCCTTAAGCGGCGCTAA
CCCCTGTAAAGCGTCTACGTACGATCGACACTACATCTCAACTTCGATTAAACTCCCAAC
AGAACAGACCCCTGGGACGATTACCTAAGATGTTGAACCTTACCGTATGAATGCCGCACC
AAGAGATAGGCAAGTCATCGCGGGACAGACGCCGCCACAGCATGTGGTTCTATCGCCCGT
TCAGGTTGTTCTATGCGCGTTGGGGTGAGTGGGCCGGAAATGAGTTTATTAAGTAGCTCG
AAAGGATGCCAGGCTTCCCAGCGGCACCTCTCAGATCTGCATGTGCGCTATGTTCCGTCA
TGTCCTATTCTAGCAGAGGCCAAAGTAGAGCCCCATCCCTAACATGACTATGTAGTATTA
CGAA
>Rosalind_7008
TGATTGATTGGTGACTGACCATTTAGGCTTAATGGGCAGTGCTGCCATACCACACGCTCG
TTAACCGACTCTTCCCAGCAACTGATCTTGATAGCTGGGTATTGTTGTATCGGTTGGTGC
GATCGTTCCTATGACTTCATAAGTGCATCGATCTGTCCAGCCGTCACTCACCTTGGAAGA
CCCGCTCCACAATACCTTGCACCTTCACGCCATAAGACAAGCCGCCTAGTTTAGCGAGTT
GGTTATCCTGCACTAGCCTCCGATAGATGTCGGAAGTCAGATTATAGATTGGTGCGCATA
TAACAGTCCACAGTAACCGATACTCGCATTAGCACATCCAACCATCCATCACGCTAGAAA
GCCATCAATGGGAAAGTTCTCCACACATGATACCGCATAGTTTAACGTTATTAACATATG
AATCCCTGTGTCAAAGGAATTACAAACATCCAATATTCCTGGAGAATGGCGAATTTCTTT
CACTGTTGCCGAGGTTGCTCTTCTCGGCGAGTAACTTAGTCCCCCGAGGATCATCTTATC
TCCCAGCTAGTCATTCGCATACCATAGCAACTCTGGAGTGCACCGAAGCGGAAATCAATA
GCCTCCTAGTCATGTAGCGCATTCATGCTGGTAGAGACAAGTTAGTCCGCCAGCTAGGAG
GAACGGATTACACCAGGAGTTATGGGCGCAAGCTTTAAATACATAGCACTAGTAAGAACT
CAGGGACCAATGTCAGCCGCGACCGTACTCGATTCAACCGCAGGGTCCGCCCTGCCTTAG
GGTCCACTGTAGCGAGCTCGACACCTCCACAAAGTCACCCCTCACAAGCTGTAAAAGTGA
GGTTGTCTTCCGTAAATGCACTAGGGCTTGACCTTTCGTCTGACTAACCTGAGTCTATCT
TGCC
>Rosalind_9687
AGGGATAGTCTTCGGGTTATAGATGAGCGTACCGTTTGGGGTGGTGGAAAGTAAGACGAG
CAACCGACGGATAGTTAGGTCGCACCAGGATGAATAATACCCGGGTGGGAGAACCAGAAG
TGGATGGAGCAGCCGCGTTATCAACCCCTTTGTCCCATCGACCTGCCGCTTATTAGCTAT
GGCCAAATGAATCCTCCATATCAAGATCAGTGACTGAGTACGACGTTAGTGCGGTTATAT
GGTAACATACCTCCCCAGGGTATATAGCAGTGTCCAGTAGCTTATAGTTTCGTCCATGAA
CCAACCAGTATACAAGGTAGGATGCGGCCTAATCTGCTTGCATCGCGACGGCGAGTTTAA
TAGTCACCAAACACAACTAAGCGCGATCAGAAGCCTTATTCCGATATTAGACGTTTTCCG
GCAGTATGTGTTCCGCTCACAAGTCGACCGATGTTACCGATTGCTCTTACGTTTCAATAG
CCGGATCACTTTATTTGTGCATATAGAGCTCCAAGGTGTCAACTGCCTATCCAACTAACC
CCCCTCTTGCCATTGAGGATTGGTTTGTGCTCGTGCTTGGAGTAATATGTCACATAGTTC
GAGAATAGTGTGGTAAAGTACCGCCTGTGTGAAGCATTAGTGCGACTTGGTTAAAATCAA
AGCGGTGCACGCGCCCAAGCCTTCTTTCAAACAAACGGATAGTGGATCTAAGCTTTTGAT
TACATAACGCCCGGCTAAATTGTTTTACCTAAACAGTAGTATTCCGCAGTGTCCAGAATG
GGCCTAACTAGTACAGCACGTCGTTCCTTCCTTGTCAAGACTGGGACGAGATTTGCGTCA
CGCGAAGGTTTACCAACTTGTACCTCGGTCACCGGAAGCTTGATCTGTGTGCCTGTAAGG
TCAC
>Rosalind_5949
TTCTGATTTGCTTCGCCGCCATAATTTACCATATAGCCTAGATATGACGATGGCCACCAA
TACTAGTACTCAGCATGAGTCTGTAATCAAGTCCAGCTCAGGCTGAAGAACGCGATGCCG
CATATTCAGGCTTTCGTAGGTTTCATTTAATGTGTGACTACTAATGGTTGGAATCAATCT
CAGTGGTTGGGAAAAAGTACTCTCTTATCAGAAGGTGCACTTCTTGCACTAGGTTATGGA
CTACGTCATTATGCACGCCAATGAAAAGCGCCGCGAAAGAATGCGGCCCAATCAATATTC
ACGAATTCTCACACGTCTATCGGTGTAGCTTTTAGTGTTATAGCGATCCCCGGGCCTTGC
TAAGAATCACGGCACAGTGTTCAGTTGGGTCGAGTAGATTATAGGGAGGTTTCCGAGGCC
TGGAGGTTAGCGCCTCGATTTCTAAGTGCAAGAGAGGTCCCAGATCGCTTTCGCAGTTTT
GCTTGACGGGATCAGACTTTGGAGCATGGGCTCTGGATCATACATACTCGCTTGTGACGG
AACGGTACGGAGGCTCATGGCTACACCCGGGGCACTTAAATGCATGAACGTAAGATATAG
AAGTCACAATTAAGATTAGTGAGGGTAGTGCCCAGGTGCCTTTCCGTATCTGAGGGTAAT
GCCCGCTTGAACACTATTCTAAGCATAAGGTGACAGACCAGACTGGTCAGTTCTTGACGC
CCCTCTTGCTCTGCTGGCGCAATAGTATTGACAACCAAAGATATCGTCCAGACCCCTACC
GGCCGGATAGTATGCATTAGATGCTGTGACATAGGCTAAAATTAGGCAGTCCTTAACTCT
TTAGCCCTCCGGGCATTAGGGAGCACCGTGGTTTCAGCCGGTAATCCTCATTACAGAGCA
CGAA
>Rosalind_3460
GCTTGATCTCGCCGTACTTTTACGCCCGTTGGTACTCGTACAGTATTACAGTAGAATCGC
GAGATTGAGCGCTATTTAAACAAAACTCACTGGTACTGCCTGCTAGACAACTATAGAATA
TATCCGACCAGGCGGAGCCATCCACGACGATTGGGGGTACCAAAGCCAGAATTCAGTTCT
TGATTCAAAGATCTGCACGGACGAGCGTTTCTCCGTAAGGGAGCCTGTTAGTCGAACACA
CAGTGTGTTCAGAACTCTGCCCAGCGATGGTTATAACGAAGTGTGATATACTGCGGCTCA
CGAGTGATTTTCACACTGGGCCGGCCTCAATATTAGGCCTTGGCCCGTCTGTAGTGGGAC
TTGGCAAAACTGAATGCCAGGACTTAGTACGTGGCTTTGGGACTCCCGCTCCCAACATAA
GTACATTTCTTCAGTACTGTATAGCGAATCCTCCAAAGTAGAACTGTCGGCAGTAAGGGA
CAGCAAACATCTTTTCAAGTCGTAGGCGAGGTATCAGAACTACCTCAATATACAAATGGA
GACCTTCTTCGGGACATTAAGGCCGTGCCATTAGGGATGCGCTTTCAGCGCCGTGATCGT
GTCCGTACGGTCCAACTTCAATGGGGGTAGCAGGCGCGCCCACATACTTGCAGCGCTCAC
CGTATGGCGTGTCGCACGTTTAGGAACGAAAAGGGGTTACGACGGTACTTGCTAAGTCTT
CTCTGGCGCCAGGAACGTAGCTAGTCTTTCTTACTGAGCTATCAGGTTATTGAACGAGCT
TAGCCGGCGTCATGGGGCTTGTCGGATGACGATGAATTATAATCAGAAGATGCATTAGTT
TGAGGCCGGGGCACCTCCAGGACTTCATTAGGTTACTAATGTTACGAATGTCTGCGCTAC
CCTT";
        private const string _hugeFastaAnswer = "TGATCTAATGCGCCACTGCCAGCGACTACTAACTAGCGGAGGCATCAACATAAACACCCCTAAACTAAGAACACCTCAGTCTCACTTAACTACGAAAGGCATCTCGGCGACCAAAGGTTGTATGCTACACGGCCCAGCGATAATCCATAATGGCTAACTCCTAACACTCAAATCGGTTCATGATAAATGGAACAACGTGCTCCTGCGCGACAACCGACGCCCCCCTTACTGTGGCAATAATTTTGTCGTTAGCCCCCGCCCCGAAAACGGTGGCAATGAACTTAGAGCTAATCCGGCTCATGAAAGTCTACATTATTCAGTTGTCGTCATAGTAAGGTCAACGCAAAACCAAGGTCGTAATGGGGAAACCGGAAAAATGAGCACGCACAAAAGCGTATAGTTCAACAGTACCCAAAGATTGTACTGTATGCCACATGATTTAAAAGCACGATATAGTTGAGAGGTATAGATAACTACTGACAATGATAATCTCTTCACGCCTTATGTGGACTCTCGTCGTCACTTCATTTCCAACTACAGCCCCTAAAGGGCATAAATATTCAACCGCAACTATCCAAGATGTTCGAGCGAACATAATACGACACGAACGTAAGAAAGGACAGGATATTGGAAAAATAACTACATTATAACAGCAACAAAAGAAGATTCCACACTAATTCCAGGATAGGAAGAGACACATAAGGAATCTTTTTTACCAGTCACGCATGCCCGGCGCGCGTAGTGGTATTCAAACCGAAATAAAGGGCATTGACCCGAACCGGACAAACCTAGAGAGCACGGCGCCACGACCTAGACGCGAATGAAAAGTTCGTGAAGTCTCGTTTCATTCTATCAACCAGCACCGCAGTGGCCTAAGCCTTTAATCAATCGACTGGATAACGAC";
        #endregion
        [Test, TestCaseSource("ConsensusString_TestCases")]
        public string ConsensusString_Test(string sample)
        {
            var parser = new FastaParser(sample, AlphabetType.StrictDna, GeneticCode.Standard).Parse();
            var builder = new ConsensusBuilder(parser);
            return builder.GetConsensusString();
        }

        public IEnumerable<ITestCaseData> ConsensusString_TestCases()
        {
            yield return new TestCaseData(_sampleFastaSequences).Returns("ATGCAACT").SetName("Rosalind sample returns correct answer");
            yield return new TestCaseData(_hugeFastaSequences).Returns(_hugeFastaAnswer).SetName("Rosalind problem correct answer");
            yield return new TestCaseData(_hugeFastaSequences.Substring(0, _hugeFastaSequences.Length - 5)).Throws(typeof(ArgumentException)).SetName("Unequal sequence length fails");
        } 
    }
}
